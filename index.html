<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proxy Configs</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --bg-tertiary: #3a3a3a;
            --text-primary: #e0e0e0;
            --text-secondary: #b0b0b0;
            --accent: #6366f1;
            --accent-hover: #818cf8;
            --border: #404040;
            --success: #10b981;
            --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        [data-theme="light"] {
            --bg-primary: #f5f5f5;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f0f0f0;
            --text-primary: #1a1a1a;
            --text-secondary: #666666;
            --accent: #6366f1;
            --accent-hover: #818cf8;
            --border: #e0e0e0;
            --success: #10b981;
            --card-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            padding: 1rem;
            min-height: 100vh;
            transition: background 0.3s ease, color 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .controls {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .theme-toggle {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.2s ease;
        }

        .theme-toggle:hover {
            background: var(--bg-tertiary);
        }

        select {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            min-width: 200px;
            transition: all 0.2s ease;
        }

        select:focus {
            outline: none;
            border-color: var(--accent);
        }

        .configs-container {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            max-height: 70vh;
            overflow-y: auto;
        }

        .configs-text {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            color: var(--text-primary);
            white-space: pre-wrap;
            word-break: break-all;
            line-height: 1.8;
        }

        .config-item {
            margin-bottom: 0.5rem;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border);
        }

        .config-item:last-child {
            border-bottom: none;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin: 2rem 0;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 200px;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--accent-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(99, 102, 241, 0.3);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover:not(:disabled) {
            background: var(--bg-secondary);
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .load-more {
            display: block;
            width: 100%;
            max-width: 300px;
            margin: 2rem auto;
            padding: 0.75rem 1.5rem;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .load-more:hover:not(:disabled) {
            background: var(--accent-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(99, 102, 241, 0.3);
        }

        .load-more:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
        }

        .error {
            background: #ef4444;
            color: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            text-align: center;
        }

        .stats {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.25rem;
            }

            select {
                min-width: 100%;
            }

            .header {
                flex-direction: column;
                align-items: stretch;
            }

            .controls {
                flex-direction: column;
            }

            .theme-toggle {
                width: 100%;
            }

            .configs-container {
                padding: 1rem;
                max-height: 60vh;
            }

            .configs-text {
                font-size: 0.85rem;
            }

            .action-buttons {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                min-width: auto;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 0.5rem;
            }

            .configs-container {
                padding: 0.75rem;
                max-height: 50vh;
            }

            .configs-text {
                font-size: 0.75rem;
            }

            .action-buttons {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                min-width: auto;
                font-size: 0.9rem;
                padding: 0.65rem 1.25rem;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>Proxy Configurations</h1>
            <div class="controls">
                <select id="countrySelect">
                    <option value="all">Ğ’ÑĞµ Ñ…Ğ°Ğ»ÑĞ²Ğ½Ñ‹Ğµ ÑÑ‚Ñ€Ğ°Ğ½Ñ‹</option>
                    <option value="FR">ğŸ‡«ğŸ‡· Seine-Saint-Denis (196)</option>
                    <option value="MD">ğŸ‡²ğŸ‡© ChiÈ™inÄƒu Municipality (138)</option>
                    <option value="NL">ğŸ‡³ğŸ‡± North Holland (105)</option>
                    <option value="GB">ğŸ‡¬ğŸ‡§ Manchester (92)</option>
                    <option value="US">ğŸ‡ºğŸ‡¸ Washington (86)</option>
                    <option value="CY">ğŸ‡¨ğŸ‡¾ Nicosia (85)</option>
                    <option value="HK">ğŸ‡­ğŸ‡° HK (45)</option>
                    <option value="DE">ğŸ‡©ğŸ‡ª Saxony (30)</option>
                    <option value="BG">ğŸ‡§ğŸ‡¬ Sofia-Capital (26)</option>
                    <option value="CA">ğŸ‡¨ğŸ‡¦ Quebec (9)</option>
                    <option value="SG">ğŸ‡¸ğŸ‡¬ SG (8)</option>
                    <option value="TR">ğŸ‡¹ğŸ‡· Ä°zmir Province (8)</option>
                    <option value="LV">ğŸ‡±ğŸ‡» RÄ«ga (8)</option>
                    <option value="JP">ğŸ‡¯ğŸ‡µ Tokyo (8)</option>
                    <option value="IN">ğŸ‡®ğŸ‡³ Telangana (6)</option>
                    <option value="RU">ğŸ‡·ğŸ‡º Moscow (6)</option>
                    <option value="MY">ğŸ‡²ğŸ‡¾ Kuala Lumpur (5)</option>
                    <option value="TW">ğŸ‡¹ğŸ‡¼ Taipei City (5)</option>
                    <option value="FI">ğŸ‡«ğŸ‡® Uusimaa (5)</option>
                    <option value="VN">ğŸ‡»ğŸ‡³ Hanoi (4)</option>
                    <option value="BR">ğŸ‡§ğŸ‡· SÃ£o Paulo (3)</option>
                    <option value="IT">ğŸ‡®ğŸ‡¹ Province of Milan (3)</option>
                    <option value="MA">ğŸ‡²ğŸ‡¦ Fes (3)</option>
                    <option value="EC">ğŸ‡ªğŸ‡¨ Pichincha (3)</option>
                    <option value="AE">ğŸ‡¦ğŸ‡ª Umm al Qaywayn (3)</option>
                    <option value="PL">ğŸ‡µğŸ‡± Mazovia (3)</option>
                    <option value="TH">ğŸ‡¹ğŸ‡­ Bangkok (3)</option>
                    <option value="PR">ğŸ‡µğŸ‡· PR (2)</option>
                    <option value="AR">ğŸ‡¦ğŸ‡· Buenos Aires F.D. (2)</option>
                    <option value="BH">ğŸ‡§ğŸ‡­ Manama (2)</option>
                    <option value="CR">ğŸ‡¨ğŸ‡· Provincia de San JosÃ© (2)</option>
                    <option value="DK">ğŸ‡©ğŸ‡° Capital Region (2)</option>
                    <option value="DZ">ğŸ‡©ğŸ‡¿ Boumerdes (2)</option>
                    <option value="EG">ğŸ‡ªğŸ‡¬ Cairo Governorate (2)</option>
                    <option value="ES">ğŸ‡ªğŸ‡¸ Madrid (2)</option>
                    <option value="ID">ğŸ‡®ğŸ‡© Jakarta (2)</option>
                    <option value="KH">ğŸ‡°ğŸ‡­ Phnom Penh (2)</option>
                    <option value="KR">ğŸ‡°ğŸ‡· Seoul (2)</option>
                    <option value="KZ">ğŸ‡°ğŸ‡¿ Almaty (2)</option>
                    <option value="LT">ğŸ‡±ğŸ‡¹ Vilnius City Municipality (2)</option>
                    <option value="MK">ğŸ‡²ğŸ‡° MK (2)</option>
                    <option value="MT">ğŸ‡²ğŸ‡¹ Valletta (2)</option>
                    <option value="MX">ğŸ‡²ğŸ‡½ Mexico City (2)</option>
                    <option value="NG">ğŸ‡³ğŸ‡¬ Lagos (2)</option>
                    <option value="PA">ğŸ‡µğŸ‡¦ Provincia de PanamÃ¡ (2)</option>
                    <option value="PE">ğŸ‡µğŸ‡ª Lima region (2)</option>
                    <option value="PT">ğŸ‡µğŸ‡¹ Lisbon (2)</option>
                    <option value="SE">ğŸ‡¸ğŸ‡ª Stockholm County (2)</option>
                    <option value="SI">ğŸ‡¸ğŸ‡® Ljubljana (2)</option>
                    <option value="ZA">ğŸ‡¿ğŸ‡¦ Gauteng (2)</option>
                    <option value="UA">ğŸ‡ºğŸ‡¦ Kyiv City (1)</option>
                    <option value="GT">ğŸ‡¬ğŸ‡¹ Guatemala (1)</option>
                    <option value="GR">ğŸ‡¬ğŸ‡· Central Macedonia (1)</option>
                    <option value="AT">ğŸ‡¦ğŸ‡¹ Vienna (1)</option>
                    <option value="PY">ğŸ‡µğŸ‡¾ AsunciÃ³n (1)</option>
                    <option value="RO">ğŸ‡·ğŸ‡´ BucureÈ™ti (1)</option>
                    <option value="EE">ğŸ‡ªğŸ‡ª Tallinn (1)</option>
                    <option value="AM">ğŸ‡¦ğŸ‡² AM (1)</option>
                    <option value="CZ">ğŸ‡¨ğŸ‡¿ Prague (1)</option>
                    <option value="LU">ğŸ‡±ğŸ‡º Luxembourg (1)</option>
                    <option value="ME">ğŸ‡²ğŸ‡ª ME (1)</option>
                    <option value="XK">ğŸ‡½ğŸ‡° XK (1)</option>
                    <option value="SK">ğŸ‡¸ğŸ‡° Bratislava Region (1)</option>
                    <option value="CL">ğŸ‡¨ğŸ‡± Santiago Metropolitan (1)</option>
                    <option value="IL">ğŸ‡®ğŸ‡± Central District (1)</option>
                    <option value="BO">ğŸ‡§ğŸ‡´ La Paz Department (1)</option>
                    <option value="HU">ğŸ‡­ğŸ‡º Budapest (1)</option>
                    <option value="NO">ğŸ‡³ğŸ‡´ Oslo County (1)</option>
                    <option value="AU">ğŸ‡¦ğŸ‡º New South Wales (1)</option>
                </select>
                <select id="protocolSelect">
                    <option value="all">Ğ’ÑĞµ Ñ…Ğ°Ğ»ÑĞ²Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ»Ñ‹</option>
                    <option value="vless">VLESS (579)</option>
                    <option value="vmess">VMESS (104)</option>
                    <option value="trojan">TROJAN (26)</option>
                    <option value="shadowsocks">SHADOWSOCKS (252)</option>
                </select>
                <button class="theme-toggle" id="themeToggle">ğŸŒ™</button>
            </div>
        </div>

        <div id="errorContainer"></div>
        <div class="stats" id="stats"></div>
        <div class="configs-container">
            <div class="configs-text" id="configsText"></div>
        </div>
        <div class="action-buttons">
            <button class="btn btn-secondary" id="copyBtn">ĞšĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ²ÑĞµ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³Ğ¸</button>
            <button class="btn btn-primary" id="loadMoreBtn">Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ ÑĞ»ĞµĞ´ÑƒÑÑ‰ÑƒÑ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ</button>
            <button class="btn btn-primary" id="loadAllBtn">Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³Ğ¸ ÑÑ€Ğ°Ğ·Ñƒ</button>
        </div>
        <div class="loading" id="loading" style="display: none;">Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°...</div>
    </div>

    <script>
        const API_BASE = 'https://megav.app/servers-api/configs';
        let currentPage = 1;
        let currentCountry = 'all';
        let currentProtocol = 'all';
        let totalPages = 1;
        let isLoading = false;

        // Theme management
        const themeToggle = document.getElementById('themeToggle');
        const html = document.documentElement;

        // Load theme from localStorage or default to dark
        const savedTheme = localStorage.getItem('theme') || 'dark';
        html.setAttribute('data-theme', savedTheme);
        themeToggle.textContent = savedTheme === 'dark' ? 'ğŸŒ™' : 'â˜€ï¸';

        themeToggle.addEventListener('click', () => {
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            themeToggle.textContent = newTheme === 'dark' ? 'ğŸŒ™' : 'â˜€ï¸';
            localStorage.setItem('theme', newTheme);
        });

        // Country selection
        const countrySelect = document.getElementById('countrySelect');
        countrySelect.addEventListener('change', () => {
            currentCountry = countrySelect.value;
            currentPage = 1;
            document.getElementById('configsText').textContent = '';
            loadConfigs();
        });

        // Protocol selection
        const protocolSelect = document.getElementById('protocolSelect');
        protocolSelect.addEventListener('change', () => {
            currentProtocol = protocolSelect.value;
            currentPage = 1;
            document.getElementById('configsText').textContent = '';
            loadConfigs();
        });

        // Load configs with CORS proxy fallback
        async function loadConfigs() {
            if (isLoading) return;

            isLoading = true;
            const loadingEl = document.getElementById('loading');
            const loadMoreBtn = document.getElementById('loadMoreBtn');
            const errorContainer = document.getElementById('errorContainer');
            const configsText = document.getElementById('configsText');
            const statsEl = document.getElementById('stats');

            errorContainer.innerHTML = '';
            loadingEl.style.display = 'block';
            loadMoreBtn.disabled = true;

            try {
                const params = new URLSearchParams({
                    page: currentPage,
                    per_page: 20
                });

                if (currentCountry !== 'all') {
                    params.append('country', currentCountry);
                }

                if (currentProtocol !== 'all') {
                    params.append('protocol', currentProtocol);
                }

                const url = `${API_BASE}?${params.toString()}`;
                let response;

                // Try direct fetch first
                try {
                    response = await fetch(url, {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json',
                        },
                        mode: 'cors'
                    });
                    // Check if response is actually ok (not a CORS error page)
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}`);
                    }
                } catch (corsError) {
                    // If CORS fails, try with CORS proxy
                    console.log('Direct fetch failed, trying CORS proxy...');
                    const proxies = [
                        `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`,
                        `https://corsproxy.io/?${encodeURIComponent(url)}`,
                        `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(url)}`
                    ];

                    let lastError = corsError;
                    for (const proxyUrl of proxies) {
                        try {
                            response = await fetch(proxyUrl, {
                                method: 'GET',
                                headers: {
                                    'Accept': 'application/json',
                                }
                            });
                            if (response.ok) {
                                break;
                            }
                        } catch (proxyError) {
                            lastError = proxyError;
                            continue;
                        }
                    }

                    if (!response || !response.ok) {
                        throw lastError;
                    }
                }

                // Final check
                if (!response || !response.ok) {
                    throw new Error(`HTTP error! status: ${response?.status || 'unknown'}`);
                }

                const data = await response.json();

                totalPages = data.total_pages || 1;
                const configs = data && data.configs && Array.isArray(data.configs) ? data.configs : [];
                const workingConfigs = configs.filter(config => config.v2ray_status === 'working');

                if (workingConfigs.length === 0 && currentPage === 1) {
                    configsText.textContent = 'ĞĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¹ ÑĞ¾ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ¾Ğ¼ "working"';
                } else if (workingConfigs.length === 0 && currentPage > 1) {
                    // Ğ•ÑĞ»Ğ¸ Ğ½Ğ° ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ¹ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğµ Ğ½ĞµÑ‚ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³Ğ¾Ğ²
                    const currentText = configsText.textContent;
                    configsText.textContent = currentText + '\n\n--- Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° ' + currentPage + ' Ğ¿ÑƒÑÑ‚Ğ° ---';
                } else {
                    // Add configs to text block, one per line
                    const configUrls = workingConfigs.map(config => config.config_url);
                    const currentText = configsText.textContent;
                    const newText = configUrls.join('\n\n');

                    if (currentPage === 1) {
                        configsText.textContent = newText;
                    } else {
                        // Ğ£Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¾ Ğ¿ÑƒÑÑ‚Ğ¾Ğ¹ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğµ, ĞµÑĞ»Ğ¸ Ğ¾Ğ½Ğ¾ Ğ±Ñ‹Ğ»Ğ¾
                        const cleanedText = currentText.replace(/\n\n--- Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° \d+ Ğ¿ÑƒÑÑ‚Ğ° ---$/, '');
                        configsText.textContent = cleanedText + '\n\n' + newText;
                    }
                }

                // Update stats
                const totalConfigs = configsText.textContent.split('\n\n').filter(line => line.trim().length > 0 && !line.includes('--- Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ°')).length;
                statsEl.textContent = `ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ğ½Ğ¾ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¹: ${totalConfigs}`;

                // Always show and enable load more button
                loadMoreBtn.style.display = 'block';
                loadMoreBtn.disabled = false;
                loadMoreBtn.textContent = 'Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ ÑĞ»ĞµĞ´ÑƒÑÑ‰ÑƒÑ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ';

            } catch (error) {
                let errorMessage = error.message;
                if (errorMessage.includes('Failed to fetch') || errorMessage.includes('NetworkError')) {
                    errorMessage = 'ĞÑˆĞ¸Ğ±ĞºĞ° CORS. ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚ÑŒ Ñ„Ğ°Ğ¹Ğ» Ñ‡ĞµÑ€ĞµĞ· Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞµÑ€Ğ²ĞµÑ€ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, Ñ‡ĞµÑ€ĞµĞ· Live Server Ğ² VS Code) Ğ¸Ğ»Ğ¸ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğº Ğ¸Ğ½Ñ‚ĞµÑ€Ğ½ĞµÑ‚Ñƒ.';
                }
                errorContainer.innerHTML = `<div class="error">ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸: ${errorMessage}<br><small>ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ Ğ¸Ğ»Ğ¸ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞµÑ€Ğ²ĞµÑ€ Ğ´Ğ»Ñ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°.</small></div>`;
                console.error('Error loading configs:', error);
            } finally {
                isLoading = false;
                loadingEl.style.display = 'none';
                // Always re-enable button after loading
                loadMoreBtn.disabled = false;
                loadMoreBtn.textContent = 'Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ ÑĞ»ĞµĞ´ÑƒÑÑ‰ÑƒÑ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ';
            }
        }


        // Copy button
        document.getElementById('copyBtn').addEventListener('click', async () => {
            const configsText = document.getElementById('configsText');
            const textToCopy = configsText.textContent.trim();

            if (!textToCopy || textToCopy === 'ĞĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¹ ÑĞ¾ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ¾Ğ¼ "working"') {
                alert('ĞĞµÑ‚ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³Ğ¾Ğ² Ğ´Ğ»Ñ ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ');
                return;
            }

            try {
                await navigator.clipboard.writeText(textToCopy);
                const copyBtn = document.getElementById('copyBtn');
                const originalText = copyBtn.textContent;
                copyBtn.textContent = 'Ğ¡ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾!';
                copyBtn.style.background = 'var(--success)';
                setTimeout(() => {
                    copyBtn.textContent = originalText;
                    copyBtn.style.background = '';
                }, 2000);
            } catch (err) {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = textToCopy;
                textArea.style.position = 'fixed';
                textArea.style.opacity = '0';
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    const copyBtn = document.getElementById('copyBtn');
                    const originalText = copyBtn.textContent;
                    copyBtn.textContent = 'Ğ¡ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾!';
                    copyBtn.style.background = 'var(--success)';
                    setTimeout(() => {
                        copyBtn.textContent = originalText;
                        copyBtn.style.background = '';
                    }, 2000);
                } catch (fallbackErr) {
                    alert('ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ. ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ Ğ²Ñ‹Ğ´ĞµĞ»Ğ¸Ñ‚ÑŒ Ñ‚ĞµĞºÑÑ‚ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ.');
                }
                document.body.removeChild(textArea);
            }
        });

        // Load more button
        document.getElementById('loadMoreBtn').addEventListener('click', () => {
            if (!isLoading) {
                currentPage++;
                loadConfigs();
            }
        });

        // Load all configs (20 pages ahead)
        async function loadAllConfigs() {
            if (isLoading) return;

            isLoading = true;
            const loadingEl = document.getElementById('loading');
            const loadAllBtn = document.getElementById('loadAllBtn');
            const loadMoreBtn = document.getElementById('loadMoreBtn');
            const errorContainer = document.getElementById('errorContainer');
            const configsText = document.getElementById('configsText');
            const statsEl = document.getElementById('stats');

            errorContainer.innerHTML = '';
            loadingEl.style.display = 'block';
            loadingEl.textContent = 'Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° 20 ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†...';
            loadAllBtn.disabled = true;
            loadMoreBtn.disabled = true;

            try {
                const startPage = currentPage + 1;
                const endPage = currentPage + 20;
                const pages = [];
                for (let i = startPage; i <= endPage; i++) {
                    pages.push(i);
                }

                // Create all fetch promises
                const fetchPromises = pages.map(page => {
                    const params = new URLSearchParams({
                        page: page,
                        per_page: 20
                    });

                    if (currentCountry !== 'all') {
                        params.append('country', currentCountry);
                    }

                    if (currentProtocol !== 'all') {
                        params.append('protocol', currentProtocol);
                    }

                    const url = `${API_BASE}?${params.toString()}`;

                    return fetch(url, {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json',
                        },
                        mode: 'cors'
                    }).catch(corsError => {
                        // Try CORS proxy if direct fetch fails
                        const proxies = [
                            `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`,
                            `https://corsproxy.io/?${encodeURIComponent(url)}`,
                            `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(url)}`
                        ];

                        let lastError = corsError;
                        for (const proxyUrl of proxies) {
                            try {
                                return fetch(proxyUrl, {
                                    method: 'GET',
                                    headers: {
                                        'Accept': 'application/json',
                                    }
                                });
                            } catch (proxyError) {
                                lastError = proxyError;
                                continue;
                            }
                        }
                        throw lastError;
                    });
                });

                // Wait for all requests to complete
                const responses = await Promise.allSettled(fetchPromises);

                // Process all responses and parse JSON
                const dataPromises = responses.map(async (result, index) => {
                    if (result.status === 'fulfilled' && result.value.ok) {
                        try {
                            const data = await result.value.json();
                            return { success: true, data, page: startPage + index };
                        } catch (err) {
                            return { success: false, page: startPage + index };
                        }
                    }
                    return { success: false, page: startPage + index };
                });

                const allData = await Promise.allSettled(dataPromises);
                const allConfigs = [];
                let loadedPages = 0;
                let emptyPages = 0;

                allData.forEach((result) => {
                    if (result.status === 'fulfilled' && result.value.success) {
                        const data = result.value.data;
                        if (data && data.configs && Array.isArray(data.configs)) {
                            const workingConfigs = data.configs.filter(config => config.v2ray_status === 'working');
                            if (workingConfigs.length > 0) {
                                allConfigs.push(...workingConfigs.map(config => config.config_url));
                                loadedPages++;
                            } else {
                                emptyPages++;
                            }
                        } else {
                            emptyPages++;
                        }
                    } else {
                        emptyPages++;
                    }
                });

                // Add all configs to text block
                const currentText = configsText.textContent;
                const cleanedText = currentText.replace(/\n\n--- Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° \d+ Ğ¿ÑƒÑÑ‚Ğ° ---$/, '');
                const newText = allConfigs.join('\n\n');

                if (currentText && currentText.trim() !== 'ĞĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¹ ÑĞ¾ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ¾Ğ¼ "working"') {
                    configsText.textContent = cleanedText + '\n\n' + newText;
                } else {
                    configsText.textContent = newText;
                }

                // Update current page
                currentPage = endPage;

                // Update stats
                const totalConfigs = configsText.textContent.split('\n\n').filter(line => line.trim().length > 0 && !line.includes('--- Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ°')).length;
                statsEl.textContent = `ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ğ½Ğ¾ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¹: ${totalConfigs} (Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ¾ ${loadedPages} ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†, Ğ¿ÑƒÑÑ‚Ñ‹Ñ…: ${emptyPages})`;

            } catch (error) {
                let errorMessage = error.message;
                if (errorMessage.includes('Failed to fetch') || errorMessage.includes('NetworkError')) {
                    errorMessage = 'ĞÑˆĞ¸Ğ±ĞºĞ° CORS. ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚ÑŒ Ñ„Ğ°Ğ¹Ğ» Ñ‡ĞµÑ€ĞµĞ· Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞµÑ€Ğ²ĞµÑ€ Ğ¸Ğ»Ğ¸ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğº Ğ¸Ğ½Ñ‚ĞµÑ€Ğ½ĞµÑ‚Ñƒ.';
                }
                errorContainer.innerHTML = `<div class="error">ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸: ${errorMessage}</div>`;
                console.error('Error loading all configs:', error);
            } finally {
                isLoading = false;
                loadingEl.style.display = 'none';
                loadingEl.textContent = 'Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°...';
                loadAllBtn.disabled = false;
                loadMoreBtn.disabled = false;
            }
        }

        // Load all button
        document.getElementById('loadAllBtn').addEventListener('click', () => {
            if (!isLoading) {
                loadAllConfigs();
            }
        });

        // Initial load
        loadConfigs();
    </script>
</body>

</html>